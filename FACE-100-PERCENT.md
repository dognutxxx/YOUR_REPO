# แนวทางให้ Particle Face ตรงกับการ์ตูน 100%

ถ้าอยากให้ตำแหน่งอนุภาคตรงกับลายเส้นตัวการ์ตูนจริงๆ มี 3 แนวทางหลัก:

---

## 1. ใช้ Point Cloud จากไฟล์ (แนะนำ — ตรงที่สุด)

สร้างไฟล์ JSON ที่เก็บตำแหน่ง (x, y, z) ของจุดจำนวน `PARTICLE_COUNT` (เช่น 24,000 จุด) ที่ได้จากรูปการ์ตูน แล้วให้โปรเจกต์โหลดมาใช้เป็นเป้าหมาย morph

**ขั้นตอนคร่าวๆ:**

1. **ได้ Point Cloud มาจากไหน**
   - **Blender:** วางรูปการ์ตูนเป็น reference → สร้าง mesh ตาม轮廓 หรือใช้ Add → Mesh → from Image (addon) / แนะนำใช้ **Geometry Nodes** scatter points on mesh → export ตำแหน่ง
   - **Python (OpenCV + NumPy):** โหลดรูป → หา contour / edge / mask ใบหน้า → สุ่มหรือ grid sample จุดภายใน mask → แปลงพิกัดเป็นช่วงประมาณ -0.5 ถึง 0.5 (ให้ตรงกับ scale ใน Three.js) → export เป็น JSON
   - **เครื่องมือออนไลน์:** บางที่รองรับ export point cloud จากรูป (ค้น "image to point cloud")

2. **รูปแบบไฟล์ที่โปรเจกต์รองรับ**
   - วางไฟล์ชื่อ `face-points.json` ในโฟลเดอร์ `assets/` (หรือ path ที่ตั้งไว้ในโค้ด)
   - โครงสร้าง: array ของ [x, y, z] จำนวนเท่ากับ `PARTICLE_COUNT`
   - ตัวอย่าง:
   ```json
   [[0.1, 0.2, -0.1], [-0.15, 0.08, -0.18], ...]
   ```
   - หรือ array เดียวเรียงเป็น `[x0,y0,z0, x1,y1,z1, ...]`

3. **ในโปรเจกต์**
   - เปิดใช้โหลดจากไฟล์ (ใน `main.js` มีตัวเลือก `USE_FACE_FROM_FILE` และฟังก์ชันโหลด)
   - ถ้าโหลดสำเร็จ จะใช้จุดจากไฟล์เป็น target position แทนการคำนวณจาก `facePoints()`
   - จำนวนจุดในไฟล์ต้องเท่ากับ `PARTICLE_COUNT` ถ้าไม่เท่าต้อง resample ในสคริปต์ที่ generate ไฟล์

**ข้อดี:** ตรงกับรูปที่ใช้สร้าง point cloud ได้ 100% (ตามความละเอียดของจุดที่ export)  
**ข้อเสีย:** ต้องมีขั้นตอนสร้างไฟล์นอกโปรเจกต์ (Blender / Python / tool อื่น)

---

## 2. สร้าง Point Cloud จากรูปในเบราว์เซอร์ (ไม่ต้องมีไฟล์แยก)

โหลดรูปการ์ตูน (หน้าตรง, PNG มี alpha ได้) → วาดลง canvas → อ่าน pixel ที่ไม่โปร่งใส → สุ่มหรือ sample ให้ได้ N จุด → แปลง (pixel x, y) เป็น (x, y, z) โดย z อาจใช้ค่าจากความสว่างหรือคงที่

**ข้อดี:** ไม่ต้องมีไฟล์ point cloud แยก  
**ข้อเสีย:** ได้แค่ 2D silhouette (z แบนหรือประมาณจาก shading), ต้อง crop รูปให้เหลือแค่ใบหน้าและ scale ให้ตรงแกน

ในโปรเจกต์มีตัวอย่างฟังก์ชัน `facePointsFromImage(imageUrl, count)` (หรือใกล้เคียง) ให้โหลดรูปแล้ว sample เป็นจุด — ใช้ได้เมื่อต้องการดึงจากรูปโดยตรง

---

## 3. ใช้ 3D Model (OBJ/GLTF) ของตัวการ์ตูน

ถ้ามีโมเดล 3D ของตัวการ์ตูน (สร้างเองหรือดาวน์โหลด):

1. โหลดโมเดลด้วย Three.js (OBJLoader / GLTFLoader)
2. อ่าน geometry ของ mesh ใบหน้า (หรือทั้งหัว) → ดึง `position` attribute
3. ถำนวนจุดไม่เท่า `PARTICLE_COUNT` ให้ **resample**: สุ่มเลือกจุดจาก geometry หรือใช้วิธี Poisson disk / grid ให้ได้ N จุด
4. ใช้ array ตำแหน่งนี้เป็น `targetPosition` แทน `facePoints()`

**ข้อดี:** ตรงกับโมเดล 3D ทั้งรูปและมิติ  
**ข้อเสีย:** ต้องมีโมเดล 3D ที่ตรงกับตัวการ์ตูนอยู่แล้ว

---

## สรุป

| วิธี | ความตรง | ความยาก | ต้องมี |
|------|----------|---------|--------|
| 1. Point cloud จากไฟล์ JSON | สูงมาก (100% ตามที่ export) | ปานกลาง | สคริปต์/Blender สร้าง JSON |
| 2. Sample จากรูปในเบราว์เซอร์ | ดี (ตรง silhouette 2D) | ต่ำ | รูป PNG ใบหน้าตรง |
| 3. โมเดล 3D (OBJ/GLTF) | สูง | ปานกลาง | ไฟล์ 3D |

**แนวทางที่ทำให้ “ตรงกับการ์ตูน 100%” ได้จริง:**  
ใช้ **วิธีที่ 1** — สร้าง point cloud จากรูปการ์ตูน (Blender หรือ Python) แล้ว export เป็น JSON มาวางในโปรเจกต์ แล้วเปิดใช้โหลดจากไฟล์ใน `main.js`:

1. สร้างโฟลเดอร์ `assets/` ในโปรเจกต์ (ถ้ายังไม่มี)
2. วางไฟล์ `face-points.json` ที่มี array ของ `[x, y, z]` จำนวน **24,000** จุด (เท่ากับ `PARTICLE_COUNT` ใน `main.js`)
3. ใน `js/main.js` ตั้งค่า `USE_FACE_FROM_FILE = true` และตรวจว่า `FACE_POINTS_URL = 'assets/face-points.json'`
4. รันเว็บ — ถ้าโหลดสำเร็จ เป้าหมาย morph จะเป็นจุดจากไฟล์ (ตรงกับการ์ตูนตามที่ export มา)
